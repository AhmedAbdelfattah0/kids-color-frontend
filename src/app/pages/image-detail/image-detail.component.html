<div class="min-h-screen bg-[#FFFBF5] py-8 px-4">

  <!-- Back button -->
  <button
    (click)="goBack()"
    class="flex items-center gap-2 text-gray-400 hover:text-[#FF6B35] transition-colors mb-6 text-sm font-medium">
    â† Back to Gallery
  </button>

  <!-- Loading -->
  <div *ngIf="isLoading()" class="flex justify-center py-20">
    <span class="text-5xl animate-spin block">ğŸ–ï¸</span>
  </div>

  <!-- Error -->
  <div *ngIf="error() && !isLoading()" class="text-center py-20">
    <p class="text-gray-400 text-lg">{{ error() }}</p>
    <button
      (click)="goBack()"
      class="mt-4 text-[#FF6B35] underline text-sm">
      Go back
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="image() && !isLoading()" class="max-w-4xl mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

      <!-- Image preview -->
      <div>
        <div class="bg-white rounded-2xl shadow-md p-4 relative group">
          <img
            [src]="image()!.imageUrl"
            [alt]="image()!.keyword"
            class="w-full max-h-[500px] object-contain rounded-xl printable-image">

          <!-- Zoom button overlaid on image -->
          <button
            (click)="isZoomed.set(true)"
            class="absolute top-6 right-6 bg-white rounded-full w-10 h-10 flex items-center justify-center shadow-md opacity-0 group-hover:opacity-100 transition-opacity hover:scale-110 transform text-lg">
            ğŸ”
          </button>
        </div>

        <!-- Color Palette below image -->
        <app-color-palette [category]="image()!.category" class="block mt-4"></app-color-palette>
      </div>

      <!-- Details & Actions -->
      <div class="flex flex-col gap-4">

        <!-- Title & meta -->
        <div>
          <h1 class="text-3xl font-bold text-gray-800 capitalize"
            style="font-family: 'Fredoka One', sans-serif;">
            {{ image()!.keyword }}
          </h1>
          <p class="text-gray-400 text-sm mt-1">
            Added {{ image()!.createdAt | date:'mediumDate' }} Â·
            {{ image()!.downloadCount }} downloads
          </p>
        </div>

        <!-- Action buttons -->
        <div class="flex flex-col gap-3">

          <button
            (click)="print()"
            class="w-full bg-[#FF6B35] hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2">
            ğŸ–¨ï¸ Print This Page
          </button>

          <button
            (click)="download()"
            class="w-full bg-[#4ECDC4] hover:bg-teal-500 text-white font-semibold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2">
            â¬‡ï¸ Download PNG
          </button>

          <button
            (click)="toggleFavorite()"
            [class]="isFavorited()
              ? 'w-full bg-[#FF6B35] text-white font-semibold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2'
              : 'w-full bg-white border border-gray-200 text-gray-600 font-semibold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2 hover:shadow-md'">
            {{ isFavorited() ? 'â¤ï¸ Saved to Favorites' : 'ğŸ¤ Save to Favorites' }}
          </button>

          <button
            (click)="share()"
            class="w-full bg-white border border-gray-200 text-gray-600 font-semibold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2 hover:shadow-md">
            ğŸ”— Copy Share Link
          </button>

          <button
            (click)="generateSimilar()"
            class="w-full bg-white border border-gray-200 text-gray-600 font-semibold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2 hover:shadow-md">
            âœ¨ Generate Similar
          </button>

        </div>

        <!-- Copied toast -->
        <div
          *ngIf="linkCopied()"
          class="bg-green-100 text-green-700 text-sm text-center py-2 px-4 rounded-xl font-medium">
          âœ“ Link copied to clipboard!
        </div>

        <!-- Image Customizer -->
        <app-image-customizer [image]="image()!"></app-image-customizer>

      </div>
    </div>

    <!-- Related images -->
    <div *ngIf="relatedImages().length > 0" class="mt-12">
      <h2 class="text-xl font-bold text-gray-800 mb-4"
        style="font-family: 'Fredoka One', sans-serif;">
        More like this
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <app-image-card
          *ngFor="let related of relatedImages()"
          [image]="related">
        </app-image-card>
      </div>
    </div>

  </div>
</div>

<!-- Zoom Modal -->
<app-zoom-preview
  *ngIf="isZoomed() && image()"
  [imageUrl]="image()!.imageUrl"
  [keyword]="image()!.keyword"
  (close)="isZoomed.set(false)">
</app-zoom-preview>
